<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- Copyright Â© 1988-2025 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "Funding Free Software", the Front-Cover
Texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
"GNU Free Documentation License".

(a) The FSF's Front-Cover Text is:

A GNU Manual

(b) The FSF's Back-Cover Text is:

You have freedom to copy and modify this GNU Manual, like GNU
     software.  Copies published by the Free Software Foundation raise
     funds for GNU development. -->
<title>Side Effects (GNU Compiler Collection (GCC) Internals)</title>

<meta name="description" content="Side Effects (GNU Compiler Collection (GCC) Internals)">
<meta name="keywords" content="Side Effects (GNU Compiler Collection (GCC) Internals)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Option-Index.html" rel="index" title="Option Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="RTL.html" rel="up" title="RTL">
<link href="Incdec.html" rel="next" title="Incdec">
<link href="RTL-Declarations.html" rel="prev" title="RTL Declarations">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
-->
</style>


</head>

<body lang="en">
<div class="section-level-extent" id="Side-Effects">
<div class="nav-panel">
<p>
Next: <a href="Incdec.html" accesskey="n" rel="next">Embedded Side-Effects on Addresses</a>, Previous: <a href="RTL-Declarations.html" accesskey="p" rel="prev">Declarations</a>, Up: <a href="RTL.html" accesskey="u" rel="up">RTL Representation</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Option-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="Side-Effect-Expressions"><span>13.15 Side Effect Expressions<a class="copiable-link" href="#Side-Effect-Expressions"> &para;</a></span></h3>
<a class="index-entry-id" id="index-RTL-side-effect-expressions"></a>

<p>The expression codes described so far represent values, not actions.
But machine instructions never produce values; they are meaningful
only for their side effects on the state of the machine.  Special
expression codes are used to represent side effects.
</p>
<p>The body of an instruction is always one of these side effect codes;
the codes described above, which represent values, appear only as
the operands of these.
</p>
<dl class="table">
<dt><a id="index-set"></a><span><code class="code">(set <var class="var">lval</var> <var class="var">x</var>)</code><a class="copiable-link" href="#index-set"> &para;</a></span></dt>
<dd><p>Represents the action of storing the value of <var class="var">x</var> into the place
represented by <var class="var">lval</var>.  <var class="var">lval</var> must be an expression
representing a place that can be stored in: <code class="code">reg</code> (or <code class="code">subreg</code>,
<code class="code">strict_low_part</code> or <code class="code">zero_extract</code>), <code class="code">mem</code>, <code class="code">pc</code>,
or <code class="code">parallel</code>.
</p>
<p>If <var class="var">lval</var> is a <code class="code">reg</code>, <code class="code">subreg</code> or <code class="code">mem</code>, it has a
machine mode; then <var class="var">x</var> must be valid for that mode.
</p>
<p>If <var class="var">lval</var> is a <code class="code">reg</code> whose machine mode is less than the full
width of the register, then it means that the part of the register
specified by the machine mode is given the specified value and the
rest of the register receives an undefined value.  Likewise, if
<var class="var">lval</var> is a <code class="code">subreg</code> whose machine mode is narrower than
the mode of the register, the rest of the register can be changed in
an undefined way.
</p>
<p>If <var class="var">lval</var> is a <code class="code">strict_low_part</code> of a subreg, then the part
of the register specified by the machine mode of the <code class="code">subreg</code> is
given the value <var class="var">x</var> and the rest of the register is not changed.
</p>
<p>If <var class="var">lval</var> is a <code class="code">zero_extract</code>, then the referenced part of
the bit-field (a memory or register reference) specified by the
<code class="code">zero_extract</code> is given the value <var class="var">x</var> and the rest of the
bit-field is not changed.  Note that <code class="code">sign_extract</code> cannot
appear in <var class="var">lval</var>.
</p>
<p>If <var class="var">lval</var> is a <code class="code">parallel</code>, it is used to represent the case of
a function returning a structure in multiple registers.  Each element
of the <code class="code">parallel</code> is an <code class="code">expr_list</code> whose first operand is a
<code class="code">reg</code> and whose second operand is a <code class="code">const_int</code> representing the
offset (in bytes) into the structure at which the data in that register
corresponds.  The first element may be null to indicate that the structure
is also passed partly in memory.
</p>
<a class="index-entry-id" id="index-jump-instructions-and-set"></a>
<a class="index-entry-id" id="index-if_005fthen_005felse-usage"></a>
<p>If <var class="var">lval</var> is <code class="code">(pc)</code>, we have a jump instruction, and the
possibilities for <var class="var">x</var> are very limited.  It may be a
<code class="code">label_ref</code> expression (unconditional jump).  It may be an
<code class="code">if_then_else</code> (conditional jump), in which case either the
second or the third operand must be <code class="code">(pc)</code> (for the case which
does not jump) and the other of the two must be a <code class="code">label_ref</code>
(for the case which does jump).  <var class="var">x</var> may also be a <code class="code">mem</code> or
<code class="code">(plus:SI (pc) <var class="var">y</var>)</code>, where <var class="var">y</var> may be a <code class="code">reg</code> or a
<code class="code">mem</code>; these unusual patterns are used to represent jumps through
branch tables.
</p>
<p>If <var class="var">lval</var> is not <code class="code">(pc)</code>, the mode of
<var class="var">lval</var> must not be <code class="code">VOIDmode</code> and the mode of <var class="var">x</var> must be
valid for the mode of <var class="var">lval</var>.
</p>
<a class="index-entry-id" id="index-SET_005fDEST"></a>
<a class="index-entry-id" id="index-SET_005fSRC"></a>
<p><var class="var">lval</var> is customarily accessed with the <code class="code">SET_DEST</code> macro and
<var class="var">x</var> with the <code class="code">SET_SRC</code> macro.
</p>
</dd>
<dt><a id="index-return"></a><span><code class="code">(return)</code><a class="copiable-link" href="#index-return"> &para;</a></span></dt>
<dd><p>As the sole expression in a pattern, represents a return from the
current function, on machines where this can be done with one
instruction, such as VAXen.  On machines where a multi-instruction
&ldquo;epilogue&rdquo; must be executed in order to return from the function,
returning is done by jumping to a label which precedes the epilogue, and
the <code class="code">return</code> expression code is never used.
</p>
<p>Inside an <code class="code">if_then_else</code> expression, represents the value to be
placed in <code class="code">pc</code> to return to the caller.
</p>
<p>Note that an insn pattern of <code class="code">(return)</code> is logically equivalent to
<code class="code">(set (pc) (return))</code>, but the latter form is never used.
</p>
</dd>
<dt><a id="index-simple_005freturn"></a><span><code class="code">(simple_return)</code><a class="copiable-link" href="#index-simple_005freturn"> &para;</a></span></dt>
<dd><p>Like <code class="code">(return)</code>, but truly represents only a function return, while
<code class="code">(return)</code> may represent an insn that also performs other functions
of the function epilogue.  Like <code class="code">(return)</code>, this may also occur in
conditional jumps.
</p>
</dd>
<dt><a id="index-call-1"></a><span><code class="code">(call <var class="var">function</var> <var class="var">nargs</var>)</code><a class="copiable-link" href="#index-call-1"> &para;</a></span></dt>
<dd><p>Represents a function call.  <var class="var">function</var> is a <code class="code">mem</code> expression
whose address is the address of the function to be called.
<var class="var">nargs</var> is an expression which can be used for two purposes: on
some machines it represents the number of bytes of stack argument; on
others, it represents the number of argument registers.
</p>
<p>Each machine has a standard machine mode which <var class="var">function</var> must
have.  The machine description defines macro <code class="code">FUNCTION_MODE</code> to
expand into the requisite mode name.  The purpose of this mode is to
specify what kind of addressing is allowed, on machines where the
allowed kinds of addressing depend on the machine mode being
addressed.
</p>
</dd>
<dt><a id="index-clobber"></a><span><code class="code">(clobber <var class="var">x</var>)</code><a class="copiable-link" href="#index-clobber"> &para;</a></span></dt>
<dd><p>Represents the storing or possible storing of an unpredictable,
undescribed value into <var class="var">x</var>, which must be a <code class="code">reg</code>,
<code class="code">scratch</code>, <code class="code">parallel</code> or <code class="code">mem</code> expression.
</p>
<p>One place this is used is in string instructions that store standard
values into particular hard registers.  It may not be worth the
trouble to describe the values that are stored, but it is essential to
inform the compiler that the registers will be altered, lest it
attempt to keep data in them across the string instruction.
</p>
<p>If <var class="var">x</var> is <code class="code">(mem:BLK (const_int 0))</code> or
<code class="code">(mem:BLK (scratch))</code>, it means that all memory
locations must be presumed clobbered.  If <var class="var">x</var> is a <code class="code">parallel</code>,
it has the same meaning as a <code class="code">parallel</code> in a <code class="code">set</code> expression.
</p>
<p>Note that the machine description classifies certain hard registers as
&ldquo;call-clobbered&rdquo;.  All function call instructions are assumed by
default to clobber these registers, so there is no need to use
<code class="code">clobber</code> expressions to indicate this fact.  Also, each function
call is assumed to have the potential to alter any memory location,
unless the function is declared <code class="code">const</code>.
</p>
<p>If the last group of expressions in a <code class="code">parallel</code> are each a
<code class="code">clobber</code> expression whose arguments are <code class="code">reg</code> or
<code class="code">match_scratch</code> (see <a class="pxref" href="RTL-Template.html">RTL Template</a>) expressions, the combiner
phase can add the appropriate <code class="code">clobber</code> expressions to an insn it
has constructed when doing so will cause a pattern to be matched.
</p>
<p>This feature can be used, for example, on a machine that whose multiply
and add instructions don&rsquo;t use an MQ register but which has an
add-accumulate instruction that does clobber the MQ register.  Similarly,
a combined instruction might require a temporary register while the
constituent instructions might not.
</p>
<p>When a <code class="code">clobber</code> expression for a register appears inside a
<code class="code">parallel</code> with other side effects, the register allocator
guarantees that the register is unoccupied both before and after that
insn if it is a hard register clobber.  For pseudo-register clobber,
the register allocator and the reload pass do not assign the same hard
register to the clobber and the input operands if there is an insn
alternative containing the &lsquo;<samp class="samp">&amp;</samp>&rsquo; constraint (see <a class="pxref" href="Modifiers.html">Constraint Modifier Characters</a>) for
the clobber and the hard register is in register classes of the
clobber in the alternative.  You can clobber either a specific hard
register, a pseudo register, or a <code class="code">scratch</code> expression; in the
latter two cases, GCC will allocate a hard register that is available
there for use as a temporary.
</p>
<p>For instructions that require a temporary register, you should use
<code class="code">scratch</code> instead of a pseudo-register because this will allow the
combiner phase to add the <code class="code">clobber</code> when required.  You do this by
coding (<code class="code">clobber</code> (<code class="code">match_scratch</code> &hellip;)).  If you do
clobber a pseudo register, use one which appears nowhere else&mdash;generate
a new one each time.  Otherwise, you may confuse CSE.
</p>
<p>There is one other known use for clobbering a pseudo register in a
<code class="code">parallel</code>: when one of the input operands of the insn is also
clobbered by the insn.  In this case, using the same pseudo register in
the clobber and elsewhere in the insn produces the expected results.
</p>
</dd>
<dt><a id="index-use"></a><span><code class="code">(use <var class="var">x</var>)</code><a class="copiable-link" href="#index-use"> &para;</a></span></dt>
<dd><p>Represents the use of the value of <var class="var">x</var>.  It indicates that the
value in <var class="var">x</var> at this point in the program is needed, even though
it may not be apparent why this is so.  Therefore, the compiler will
not attempt to delete previous instructions whose only effect is to
store a value in <var class="var">x</var>.  <var class="var">x</var> must be a <code class="code">reg</code> expression.
</p>
<p>In some situations, it may be tempting to add a <code class="code">use</code> of a
register in a <code class="code">parallel</code> to describe a situation where the value
of a special register will modify the behavior of the instruction.
A hypothetical example might be a pattern for an addition that can
either wrap around or use saturating addition depending on the value
of a special control register:
</p>
<div class="example smallexample">
<pre class="example-preformatted">(parallel [(set (reg:SI 2) (unspec:SI [(reg:SI 3)
                                       (reg:SI 4)] 0))
           (use (reg:SI 1))])
</pre></div>


<p>This will not work, several of the optimizers only look at expressions
locally; it is very likely that if you have multiple insns with
identical inputs to the <code class="code">unspec</code>, they will be optimized away even
if register 1 changes in between.
</p>
<p>This means that <code class="code">use</code> can <em class="emph">only</em> be used to describe
that the register is live.  You should think twice before adding
<code class="code">use</code> statements, more often you will want to use <code class="code">unspec</code>
instead.  The <code class="code">use</code> RTX is most commonly useful to describe that
a fixed register is implicitly used in an insn.  It is also safe to use
in patterns where the compiler knows for other reasons that the result
of the whole pattern is variable, such as &lsquo;<samp class="samp">cpymem<var class="var">m</var></samp>&rsquo; or
&lsquo;<samp class="samp">call</samp>&rsquo; patterns.
</p>
<p>During the reload phase, an insn that has a <code class="code">use</code> as pattern
can carry a reg_equal note.  These <code class="code">use</code> insns will be deleted
before the reload phase exits.
</p>
<p>During the delayed branch scheduling phase, <var class="var">x</var> may be an insn.
This indicates that <var class="var">x</var> previously was located at this place in the
code and its data dependencies need to be taken into account.  These
<code class="code">use</code> insns will be deleted before the delayed branch scheduling
phase exits.
</p>
</dd>
<dt><a id="index-parallel"></a><span><code class="code">(parallel [<var class="var">x0</var> <var class="var">x1</var> &hellip;])</code><a class="copiable-link" href="#index-parallel"> &para;</a></span></dt>
<dd><p>Represents several side effects performed in parallel.  The square
brackets stand for a vector; the operand of <code class="code">parallel</code> is a
vector of expressions.  <var class="var">x0</var>, <var class="var">x1</var> and so on are individual
side effect expressions&mdash;expressions of code <code class="code">set</code>, <code class="code">call</code>,
<code class="code">return</code>, <code class="code">simple_return</code>, <code class="code">clobber</code> or <code class="code">use</code>.
</p>
<p>&ldquo;In parallel&rdquo; means that first all the values used in the individual
side-effects are computed, and second all the actual side-effects are
performed.  For example,
</p>
<div class="example smallexample">
<pre class="example-preformatted">(parallel [(set (reg:SI 1) (mem:SI (reg:SI 1)))
           (set (mem:SI (reg:SI 1)) (reg:SI 1))])
</pre></div>

<p>says unambiguously that the values of hard register 1 and the memory
location addressed by it are interchanged.  In both places where
<code class="code">(reg:SI 1)</code> appears as a memory address it refers to the value
in register 1 <em class="emph">before</em> the execution of the insn.
</p>
<p>It follows that it is <em class="emph">incorrect</em> to use <code class="code">parallel</code> and
expect the result of one <code class="code">set</code> to be available for the next one.
For example, people sometimes attempt to represent a jump-if-zero
instruction this way:
</p>
<div class="example smallexample">
<pre class="example-preformatted">(parallel [(set (reg:CC CC_REG) (reg:SI 34))
           (set (pc) (if_then_else
                        (eq (reg:CC CC_REG) (const_int 0))
                        (label_ref ...)
                        (pc)))])
</pre></div>

<p>But this is incorrect, because it says that the jump condition depends
on the condition code value <em class="emph">before</em> this instruction, not on the
new value that is set by this instruction.
</p>
<a class="index-entry-id" id="index-peephole-optimization_002c-RTL-representation"></a>
<p>Peephole optimization, which takes place together with final assembly
code output, can produce insns whose patterns consist of a <code class="code">parallel</code>
whose elements are the operands needed to output the resulting
assembler code&mdash;often <code class="code">reg</code>, <code class="code">mem</code> or constant expressions.
This would not be well-formed RTL at any other stage in compilation,
but it is OK then because no further optimization remains to be done.
</p>
</dd>
<dt><a id="index-cond_005fexec"></a><span><code class="code">(cond_exec [<var class="var">cond</var> <var class="var">expr</var>])</code><a class="copiable-link" href="#index-cond_005fexec"> &para;</a></span></dt>
<dd><p>Represents a conditionally executed expression.  The <var class="var">expr</var> is
executed only if the <var class="var">cond</var> is nonzero.  The <var class="var">cond</var> expression
must not have side-effects, but the <var class="var">expr</var> may very well have
side-effects.
</p>
</dd>
<dt><a id="index-sequence"></a><span><code class="code">(sequence [<var class="var">insns</var> &hellip;])</code><a class="copiable-link" href="#index-sequence"> &para;</a></span></dt>
<dd><p>Represents a sequence of insns.  If a <code class="code">sequence</code> appears in the
chain of insns, then each of the <var class="var">insns</var> that appears in the sequence
must be suitable for appearing in the chain of insns, i.e. must satisfy
the <code class="code">INSN_P</code> predicate.
</p>
<p>After delay-slot scheduling is completed, an insn and all the insns that
reside in its delay slots are grouped together into a <code class="code">sequence</code>.
The insn requiring the delay slot is the first insn in the vector;
subsequent insns are to be placed in the delay slot.
</p>
<p><code class="code">INSN_ANNULLED_BRANCH_P</code> is set on an insn in a delay slot to
indicate that a branch insn should be used that will conditionally annul
the effect of the insns in the delay slots.  In such a case,
<code class="code">INSN_FROM_TARGET_P</code> indicates that the insn is from the target of
the branch and should be executed only if the branch is taken; otherwise
the insn should be executed only if the branch is not taken.
See <a class="xref" href="Delay-Slots.html">Delay Slot Scheduling</a>.
</p>
<p>Some back ends also use <code class="code">sequence</code> objects for purposes other than
delay-slot groups.  This is not supported in the common parts of the
compiler, which treat such sequences as delay-slot groups.
</p>
<p>DWARF2 Call Frame Address (CFA) adjustments are sometimes also expressed
using <code class="code">sequence</code> objects as the value of a <code class="code">RTX_FRAME_RELATED_P</code>
note.  This only happens if the CFA adjustments cannot be easily derived
from the pattern of the instruction to which the note is attached.  In
such cases, the value of the note is used instead of best-guesing the
semantics of the instruction.  The back end can attach notes containing
a <code class="code">sequence</code> of <code class="code">set</code> patterns that express the effect of the
parent instruction.
</p></dd>
</dl>

<p>These expression codes appear in place of a side effect, as the body of
an insn, though strictly speaking they do not always describe side
effects as such:
</p>
<dl class="table">
<dt><a id="index-asm_005finput"></a><span><code class="code">(asm_input <var class="var">s</var>)</code><a class="copiable-link" href="#index-asm_005finput"> &para;</a></span></dt>
<dd><p>Represents literal assembler code as described by the string <var class="var">s</var>.
</p>
</dd>
<dt><a class="index-entry-id" id="index-unspec_005fvolatile"></a>
<a id="index-unspec"></a><span><code class="code">(unspec [<var class="var">operands</var> &hellip;] <var class="var">index</var>)</code><a class="copiable-link" href="#index-unspec"> &para;</a></span></dt>
<dt><code class="code">(unspec_volatile [<var class="var">operands</var> &hellip;] <var class="var">index</var>)</code></dt>
<dd><p>Represents a machine-specific operation on <var class="var">operands</var>.  <var class="var">index</var>
selects between multiple machine-specific operations.
<code class="code">unspec_volatile</code> is used for volatile operations and operations
that may trap; <code class="code">unspec</code> is used for other operations.
</p>
<p>These codes may appear inside a <code class="code">pattern</code> of an
insn, inside a <code class="code">parallel</code>, or inside an expression.
</p>
</dd>
<dt><a id="index-addr_005fvec"></a><span><code class="code">(addr_vec:<var class="var">m</var> [<var class="var">lr0</var> <var class="var">lr1</var> &hellip;])</code><a class="copiable-link" href="#index-addr_005fvec"> &para;</a></span></dt>
<dd><p>Represents a table of jump addresses.  The vector elements <var class="var">lr0</var>,
etc., are <code class="code">label_ref</code> expressions.  The mode <var class="var">m</var> specifies
how much space is given to each address; normally <var class="var">m</var> would be
<code class="code">Pmode</code>.
</p>
</dd>
<dt><a id="index-addr_005fdiff_005fvec"></a><span><code class="code">(addr_diff_vec:<var class="var">m</var> <var class="var">base</var> [<var class="var">lr0</var> <var class="var">lr1</var> &hellip;] <var class="var">min</var> <var class="var">max</var> <var class="var">flags</var>)</code><a class="copiable-link" href="#index-addr_005fdiff_005fvec"> &para;</a></span></dt>
<dd><p>Represents a table of jump addresses expressed as offsets from
<var class="var">base</var>.  The vector elements <var class="var">lr0</var>, etc., are <code class="code">label_ref</code>
expressions and so is <var class="var">base</var>.  The mode <var class="var">m</var> specifies how much
space is given to each address-difference.  <var class="var">min</var> and <var class="var">max</var>
are set up by branch shortening and hold a label with a minimum and a
maximum address, respectively.  <var class="var">flags</var> indicates the relative
position of <var class="var">base</var>, <var class="var">min</var> and <var class="var">max</var> to the containing insn
and of <var class="var">min</var> and <var class="var">max</var> to <var class="var">base</var>.  See rtl.def for details.
</p>
</dd>
<dt><a id="index-prefetch"></a><span><code class="code">(prefetch:<var class="var">m</var> <var class="var">addr</var> <var class="var">rws</var> <var class="var">locality</var> <var class="var">cache</var>)</code><a class="copiable-link" href="#index-prefetch"> &para;</a></span></dt>
<dd><p>Represents prefetch of memory at address <var class="var">addr</var>.
Operand <var class="var">rws</var> is 0 if the prefetch is for data to be read, 1 for being
written; 2 if read shared;
targets that do not support write or read shared prefetches should treat this
as a normal prefetch.
Operand <var class="var">locality</var> specifies the amount of temporal locality; 0 if there
is none or 1, 2, or 3 for increasing levels of temporal locality;
targets that do not support locality hints should ignore this.
</p>
<p>This insn is used to minimize cache-miss latency by moving data into a
cache before it is accessed.  It should use only non-faulting data prefetch
instructions.
</p></dd>
</dl>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Incdec.html">Embedded Side-Effects on Addresses</a>, Previous: <a href="RTL-Declarations.html">Declarations</a>, Up: <a href="RTL.html">RTL Representation</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Option-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
