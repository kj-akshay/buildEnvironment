<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- Copyright Â© 1988-2024 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "Free Software" and "Free Software Needs
Free Documentation", with the Front-Cover Texts being "A GNU Manual,"
and with the Back-Cover Texts as in (a) below.

(a) The FSF's Back-Cover Text is: "You are free to copy and modify
this GNU Manual.  Buying copies from GNU Press supports the FSF in
developing GNU and promoting software freedom." -->
<title>Create and Delete Tracepoints (Debugging with GDB)</title>

<meta name="description" content="Create and Delete Tracepoints (Debugging with GDB)">
<meta name="keywords" content="Create and Delete Tracepoints (Debugging with GDB)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Concept-Index.html" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Set-Tracepoints.html" rel="up" title="Set Tracepoints">
<link href="Enable-and-Disable-Tracepoints.html" rel="next" title="Enable and Disable Tracepoints">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span.r {font-family: initial; font-weight: normal; font-style: normal}
span:hover a.copiable-link {visibility: visible}
-->
</style>


</head>

<body lang="en">
<div class="subsection-level-extent" id="Create-and-Delete-Tracepoints">
<div class="nav-panel">
<p>
Next: <a href="Enable-and-Disable-Tracepoints.html" accesskey="n" rel="next">Enable and Disable Tracepoints</a>, Up: <a href="Set-Tracepoints.html" accesskey="u" rel="up">Commands to Set Tracepoints</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Create-and-Delete-Tracepoints-1"><span>13.1.1 Create and Delete Tracepoints<a class="copiable-link" href="#Create-and-Delete-Tracepoints-1"> &para;</a></span></h4>

<dl class="table">
<dt><a class="index-entry-id" id="index-trace"></a>
<a id="index-set-tracepoint"></a><span><code class="code">trace <var class="var">locspec</var></code><a class="copiable-link" href="#index-set-tracepoint"> &para;</a></span></dt>
<dd><p>The <code class="code">trace</code> command is very similar to the <code class="code">break</code> command.
Its argument <var class="var">locspec</var> can be any valid location specification.
See <a class="xref" href="Location-Specifications.html">Location Specifications</a>.  The <code class="code">trace</code> command defines a tracepoint,
which is a point in the target program where the debugger will briefly stop,
collect some data, and then allow the program to continue.  Setting a tracepoint
or changing its actions takes effect immediately if the remote stub
supports the &lsquo;<samp class="samp">InstallInTrace</samp>&rsquo; feature (see <a class="pxref" href="General-Query-Packets.html#install-tracepoint-in-tracing">install tracepoint in tracing</a>).
If remote stub doesn&rsquo;t support the &lsquo;<samp class="samp">InstallInTrace</samp>&rsquo; feature, all
these changes don&rsquo;t take effect until the next <code class="code">tstart</code>
command, and once a trace experiment is running, further changes will
not have any effect until the next trace experiment starts.  In addition,
<small class="sc">GDB</small> supports <em class="dfn">pending tracepoints</em>&mdash;tracepoints whose
address is not yet resolved.  (This is similar to pending breakpoints.)
Pending tracepoints are not downloaded to the target and not installed
until they are resolved.  The resolution of pending tracepoints requires
<small class="sc">GDB</small> support&mdash;when debugging with the remote target, and
<small class="sc">GDB</small> disconnects from the remote stub (see <a class="pxref" href="Starting-and-Stopping-Trace-Experiments.html#disconnected-tracing">disconnected tracing</a>), pending tracepoints can not be resolved (and downloaded to
the remote stub) while <small class="sc">GDB</small> is disconnected.
</p>
<p>Here are some examples of using the <code class="code">trace</code> command:
</p>
<div class="example smallexample">
<pre class="example-preformatted">(gdb) <b class="b">trace foo.c:121</b>    // a source file and line number

(gdb) <b class="b">trace +2</b>           // 2 lines forward

(gdb) <b class="b">trace my_function</b>  // first source line of function

(gdb) <b class="b">trace *my_function</b> // EXACT start address of function

(gdb) <b class="b">trace *0x2117c4</b>    // an address
</pre></div>

<p>You can abbreviate <code class="code">trace</code> as <code class="code">tr</code>.
</p>
</dd>
<dt><code class="code">trace <var class="var">locspec</var> if <var class="var">cond</var></code></dt>
<dd><p>Set a tracepoint with condition <var class="var">cond</var>; evaluate the expression
<var class="var">cond</var> each time the tracepoint is reached, and collect data only
if the value is nonzero&mdash;that is, if <var class="var">cond</var> evaluates as true.
See <a class="xref" href="Tracepoint-Conditions.html">Tracepoint Conditions</a>, for more
information on tracepoint conditions.
</p>
</dd>
<dt><a class="index-entry-id" id="index-fast-tracepoints_002c-setting"></a>
<a class="index-entry-id" id="index-ftrace"></a>
<a id="index-set-fast-tracepoint"></a><span><code class="code">ftrace <var class="var">locspec</var> [ if <var class="var">cond</var> ]</code><a class="copiable-link" href="#index-set-fast-tracepoint"> &para;</a></span></dt>
<dd><p>The <code class="code">ftrace</code> command sets a fast tracepoint.  For targets that
support them, fast tracepoints will use a more efficient but possibly
less general technique to trigger data collection, such as a jump
instruction instead of a trap, or some sort of hardware support.  It
may not be possible to create a fast tracepoint at the desired
location, in which case the command will exit with an explanatory
message.
</p>
<p><small class="sc">GDB</small> handles arguments to <code class="code">ftrace</code> exactly as for
<code class="code">trace</code>.
</p>
<p>On 32-bit x86-architecture systems, fast tracepoints normally need to
be placed at an instruction that is 5 bytes or longer, but can be
placed at 4-byte instructions if the low 64K of memory of the target
program is available to install trampolines.  Some Unix-type systems,
such as <small class="sc">GNU</small>/Linux, exclude low addresses from the program&rsquo;s
address space; but for instance with the Linux kernel it is possible
to let <small class="sc">GDB</small> use this area by doing a <code class="command">sysctl</code> command
to set the <code class="code">mmap_min_addr</code> kernel parameter, as in
</p>
<div class="example">
<pre class="example-preformatted">sudo sysctl -w vm.mmap_min_addr=32768
</pre></div>

<p>which sets the low address to 32K, which leaves plenty of room for
trampolines.  The minimum address should be set to a page boundary.
</p>
</dd>
<dt><a class="index-entry-id" id="index-static-tracepoints_002c-setting"></a>
<a class="index-entry-id" id="index-probe-static-tracepoint-marker"></a>
<a class="index-entry-id" id="index-strace"></a>
<a id="index-set-static-tracepoint"></a><span><code class="code">strace [<var class="var">locspec</var> | -m <var class="var">marker</var>] [ if <var class="var">cond</var> ]</code><a class="copiable-link" href="#index-set-static-tracepoint"> &para;</a></span></dt>
<dd><p>The <code class="code">strace</code> command sets a static tracepoint.  For targets that
support it, setting a static tracepoint probes a static
instrumentation point, or marker, found at the code locations that
result from resolving <var class="var">locspec</var>.  It may not be possible to set a
static tracepoint at the desired code location, in which case the
command will exit with an explanatory message.
</p>
<p><small class="sc">GDB</small> handles arguments to <code class="code">strace</code> exactly as for
<code class="code">trace</code>, with the addition that the user can also specify
<code class="code">-m <var class="var">marker</var></code> instead of a location spec.  This probes the marker
identified by the <var class="var">marker</var> string identifier.  This identifier
depends on the static tracepoint backend library your program is
using.  You can find all the marker identifiers in the &lsquo;<samp class="samp">ID</samp>&rsquo; field
of the <code class="code">info static-tracepoint-markers</code> command output.
See <a class="xref" href="Listing-Static-Tracepoint-Markers.html">Listing Static Tracepoint
Markers</a>.  For example, in the following small program using the UST
tracing engine:
</p>
<div class="example smallexample">
<pre class="example-preformatted">main ()
{
  trace_mark(ust, bar33, &quot;str %s&quot;, &quot;FOOBAZ&quot;);
}
</pre></div>

<p>the marker id is composed of joining the first two arguments to the
<code class="code">trace_mark</code> call with a slash, which translates to:
</p>
<div class="example smallexample">
<pre class="example-preformatted">(gdb) info static-tracepoint-markers
Cnt Enb ID         Address            What
1   n   ust/bar33  0x0000000000400ddc in main at stexample.c:22
         Data: &quot;str %s&quot;
[etc...]
</pre></div>

<p>so you may probe the marker above with:
</p>
<div class="example smallexample">
<pre class="example-preformatted">(gdb) strace -m ust/bar33
</pre></div>

<p>Static tracepoints accept an extra collect action &mdash; <code class="code">collect
$_sdata</code>.  This collects arbitrary user data passed in the probe point
call to the tracing library.  In the UST example above, you&rsquo;ll see
that the third argument to <code class="code">trace_mark</code> is a printf-like format
string.  The user data is then the result of running that formatting
string against the following arguments.  Note that <code class="code">info
static-tracepoint-markers</code> command output lists that format string in
the &lsquo;<samp class="samp">Data:</samp>&rsquo; field.
</p>
<p>You can inspect this data when analyzing the trace buffer, by printing
the $_sdata variable like any other variable available to
<small class="sc">GDB</small>.  See <a class="xref" href="Tracepoint-Actions.html">Tracepoint Action Lists</a>.
</p>
<a class="index-entry-id" id="index-_0024tpnum"></a>
<a class="index-entry-id" id="index-last-tracepoint-number"></a>
<a class="index-entry-id" id="index-recent-tracepoint-number"></a>
<a class="index-entry-id" id="index-tracepoint-number"></a>
<p>The convenience variable <code class="code">$tpnum</code> records the tracepoint number
of the most recently set tracepoint.
</p>
</dd>
<dt><a class="index-entry-id" id="index-tracepoint-deletion"></a>
<a id="index-delete-tracepoint"></a><span><code class="code">delete tracepoint <span class="r">[</span><var class="var">num</var><span class="r">]</span></code><a class="copiable-link" href="#index-delete-tracepoint"> &para;</a></span></dt>
<dd><p>Permanently delete one or more tracepoints.  With no argument, the
default is to delete all tracepoints.  Note that the regular
<code class="code">delete</code> command can remove tracepoints also.
</p>
<p>Examples:
</p>
<div class="example smallexample">
<pre class="example-preformatted">(gdb) <b class="b">delete trace 1 2 3</b> // remove three tracepoints

(gdb) <b class="b">delete trace</b>       // remove all tracepoints
</pre></div>

<p>You can abbreviate this command as <code class="code">del tr</code>.
</p></dd>
</dl>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Enable-and-Disable-Tracepoints.html">Enable and Disable Tracepoints</a>, Up: <a href="Set-Tracepoints.html">Commands to Set Tracepoints</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
