<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.1.1, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- Copyright Â© 1988-2024 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "Free Software" and "Free Software Needs
Free Documentation", with the Front-Cover Texts being "A GNU Manual,"
and with the Back-Cover Texts as in (a) below.

(a) The FSF's Back-Cover Text is: "You are free to copy and modify
this GNU Manual.  Buying copies from GNU Press supports the FSF in
developing GNU and promoting software freedom." -->
<title>Frame Filter API (Debugging with GDB)</title>

<meta name="description" content="Frame Filter API (Debugging with GDB)">
<meta name="keywords" content="Frame Filter API (Debugging with GDB)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Concept-Index.html" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Python-API.html" rel="up" title="Python API">
<link href="Frame-Decorator-API.html" rel="next" title="Frame Decorator API">
<link href="Type-Printing-API.html" rel="prev" title="Type Printing API">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
-->
</style>


</head>

<body lang="en">
<div class="subsubsection-level-extent" id="Frame-Filter-API">
<div class="nav-panel">
<p>
Next: <a href="Frame-Decorator-API.html" accesskey="n" rel="next">Decorating Frames</a>, Previous: <a href="Type-Printing-API.html" accesskey="p" rel="prev">Type Printing API</a>, Up: <a href="Python-API.html" accesskey="u" rel="up">Python API</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsubsection" id="Filtering-Frames"><span>23.3.2.10 Filtering Frames<a class="copiable-link" href="#Filtering-Frames"> &para;</a></span></h4>
<a class="index-entry-id" id="index-frame-filters-api"></a>

<p>Frame filters are Python objects that manipulate the visibility of a
frame or frames when a backtrace (see <a class="pxref" href="Backtrace.html">Backtraces</a>) is printed by
<small class="sc">GDB</small>.
</p>
<p>Only commands that print a backtrace, or, in the case of <small class="sc">GDB/MI</small>
commands (see <a class="pxref" href="GDB_002fMI.html">The <small class="sc">GDB/MI</small> Interface</a>), those that return a collection of frames
are affected.  The commands that work with frame filters are:
</p>
<p><code class="code">backtrace</code> (see <a class="pxref" href="Backtrace.html#backtrace_002dcommand">The backtrace command</a>),
<code class="code">-stack-list-frames</code>
(see <a class="pxref" href="GDB_002fMI-Stack-Manipulation.html#g_t_002dstack_002dlist_002dframes">The -stack-list-frames command</a>),
<code class="code">-stack-list-variables</code> (see <a class="pxref" href="GDB_002fMI-Stack-Manipulation.html#g_t_002dstack_002dlist_002dvariables">The
-stack-list-variables command</a>), <code class="code">-stack-list-arguments</code>
see <a class="pxref" href="GDB_002fMI-Stack-Manipulation.html#g_t_002dstack_002dlist_002darguments">The -stack-list-arguments command</a>) and
<code class="code">-stack-list-locals</code> (see <a class="pxref" href="GDB_002fMI-Stack-Manipulation.html#g_t_002dstack_002dlist_002dlocals">The
-stack-list-locals command</a>).
</p>
<p>A frame filter works by taking an iterator as an argument, applying
actions to the contents of that iterator, and returning another
iterator (or, possibly, the same iterator it was provided in the case
where the filter does not perform any operations).  Typically, frame
filters utilize tools such as the Python&rsquo;s <code class="code">itertools</code> module to
work with and create new iterators from the source iterator.
Regardless of how a filter chooses to apply actions, it must not alter
the underlying <small class="sc">GDB</small> frame or frames, or attempt to alter the
call-stack within <small class="sc">GDB</small>.  This preserves data integrity within
<small class="sc">GDB</small>.  Frame filters are executed on a priority basis and care
should be taken that some frame filters may have been executed before,
and that some frame filters will be executed after.
</p>
<p>An important consideration when designing frame filters, and well
worth reflecting upon, is that frame filters should avoid unwinding
the call stack if possible.  Some stacks can run very deep, into the
tens of thousands in some cases.  To search every frame when a frame
filter executes may be too expensive at that step.  The frame filter
cannot know how many frames it has to iterate over, and it may have to
iterate through them all.  This ends up duplicating effort as
<small class="sc">GDB</small> performs this iteration when it prints the frames.  If
the filter can defer unwinding frames until frame decorators are
executed, after the last filter has executed, it should.  See <a class="xref" href="Frame-Decorator-API.html">Decorating Frames</a>, for more information on decorators.  Also, there are
examples for both frame decorators and filters in later chapters.
See <a class="xref" href="Writing-a-Frame-Filter.html">Writing a Frame Filter</a>, for more information.
</p>
<p>The Python dictionary <code class="code">gdb.frame_filters</code> contains key/object
pairings that comprise a frame filter.  Frame filters in this
dictionary are called <code class="code">global</code> frame filters, and they are
available when debugging all inferiors.  These frame filters must
register with the dictionary directly.  In addition to the
<code class="code">global</code> dictionary, there are other dictionaries that are loaded
with different inferiors via auto-loading (see <a class="pxref" href="Python-Auto_002dloading.html">Python Auto-loading</a>).  The two other areas where frame filter dictionaries
can be found are: <code class="code">gdb.Progspace</code> which contains a
<code class="code">frame_filters</code> dictionary attribute, and each <code class="code">gdb.Objfile</code>
object which also contains a <code class="code">frame_filters</code> dictionary
attribute.
</p>
<p>When a command is executed from <small class="sc">GDB</small> that is compatible with
frame filters, <small class="sc">GDB</small> combines the <code class="code">global</code>,
<code class="code">gdb.Progspace</code> and all <code class="code">gdb.Objfile</code> dictionaries currently
loaded.  All of the <code class="code">gdb.Objfile</code> dictionaries are combined, as
several frames, and thus several object files, might be in use.
<small class="sc">GDB</small> then prunes any frame filter whose <code class="code">enabled</code>
attribute is <code class="code">False</code>.  This pruned list is then sorted according
to the <code class="code">priority</code> attribute in each filter.
</p>
<p>Once the dictionaries are combined, pruned and sorted, <small class="sc">GDB</small>
creates an iterator which wraps each frame in the call stack in a
<code class="code">FrameDecorator</code> object, and calls each filter in order.  The
output from the previous filter will always be the input to the next
filter, and so on.
</p>
<p>Frame filters have a mandatory interface which each frame filter must
implement, defined here:
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-FrameFilter_002efilter"><span class="category-def">Function: </span><span><strong class="def-name">FrameFilter.filter</strong> <var class="def-var-arguments">(iterator)</var><a class="copiable-link" href="#index-FrameFilter_002efilter"> &para;</a></span></dt>
<dd><p><small class="sc">GDB</small> will call this method on a frame filter when it has
reached the order in the priority list for that filter.
</p>
<p>For example, if there are four frame filters:
</p>
<div class="example smallexample">
<pre class="example-preformatted">Name         Priority

Filter1      5
Filter2      10
Filter3      100
Filter4      1
</pre></div>

<p>The order that the frame filters will be called is:
</p>
<div class="example smallexample">
<pre class="example-preformatted">Filter3 -&gt; Filter2 -&gt; Filter1 -&gt; Filter4
</pre></div>

<p>Note that the output from <code class="code">Filter3</code> is passed to the input of
<code class="code">Filter2</code>, and so on.
</p>
<p>This <code class="code">filter</code> method is passed a Python iterator.  This iterator
contains a sequence of frame decorators that wrap each
<code class="code">gdb.Frame</code>, or a frame decorator that wraps another frame
decorator.  The first filter that is executed in the sequence of frame
filters will receive an iterator entirely comprised of default
<code class="code">FrameDecorator</code> objects.  However, after each frame filter is
executed, the previous frame filter may have wrapped some or all of
the frame decorators with their own frame decorator.  As frame
decorators must also conform to a mandatory interface, these
decorators can be assumed to act in a uniform manner (see <a class="pxref" href="Frame-Decorator-API.html">Decorating Frames</a>).
</p>
<p>This method must return an object conforming to the Python iterator
protocol.  Each item in the iterator must be an object conforming to
the frame decorator interface.  If a frame filter does not wish to
perform any operations on this iterator, it should return that
iterator untouched.
</p>
<p>This method is not optional.  If it does not exist, <small class="sc">GDB</small> will
raise and print an error.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-FrameFilter_002ename"><span class="category-def">Variable: </span><span><strong class="def-name">FrameFilter.name</strong><a class="copiable-link" href="#index-FrameFilter_002ename"> &para;</a></span></dt>
<dd><p>The <code class="code">name</code> attribute must be Python string which contains the
name of the filter displayed by <small class="sc">GDB</small> (see <a class="pxref" href="Frame-Filter-Management.html">Management of Frame Filters.</a>).  This attribute may contain any combination of letters
or numbers.  Care should be taken to ensure that it is unique.  This
attribute is mandatory.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-FrameFilter_002eenabled"><span class="category-def">Variable: </span><span><strong class="def-name">FrameFilter.enabled</strong><a class="copiable-link" href="#index-FrameFilter_002eenabled"> &para;</a></span></dt>
<dd><p>The <code class="code">enabled</code> attribute must be Python boolean.  This attribute
indicates to <small class="sc">GDB</small> whether the frame filter is enabled, and
should be considered when frame filters are executed.  If
<code class="code">enabled</code> is <code class="code">True</code>, then the frame filter will be executed
when any of the backtrace commands detailed earlier in this chapter
are executed.  If <code class="code">enabled</code> is <code class="code">False</code>, then the frame
filter will not be executed.  This attribute is mandatory.
</p></dd></dl>

<dl class="first-defvr first-defvar-alias-first-defvr">
<dt class="defvr defvar-alias-defvr" id="index-FrameFilter_002epriority"><span class="category-def">Variable: </span><span><strong class="def-name">FrameFilter.priority</strong><a class="copiable-link" href="#index-FrameFilter_002epriority"> &para;</a></span></dt>
<dd><p>The <code class="code">priority</code> attribute must be Python integer.  This attribute
controls the order of execution in relation to other frame filters.
There are no imposed limits on the range of <code class="code">priority</code> other than
it must be a valid integer.  The higher the <code class="code">priority</code> attribute,
the sooner the frame filter will be executed in relation to other
frame filters.  Although <code class="code">priority</code> can be negative, it is
recommended practice to assume zero is the lowest priority that a
frame filter can be assigned.  Frame filters that have the same
priority are executed in unsorted order in that priority slot.  This
attribute is mandatory.  100 is a good default priority.
</p></dd></dl>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Frame-Decorator-API.html">Decorating Frames</a>, Previous: <a href="Type-Printing-API.html">Type Printing API</a>, Up: <a href="Python-API.html">Python API</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
